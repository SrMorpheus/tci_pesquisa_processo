<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agente de Pesquisa TCI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8fafc;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        .tci-agent {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            width: 100%;
            height: 100vh;
            max-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .tci-header {
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            color: white;
            padding: 16px 20px;
            text-align: center;
            position: relative;
            flex-shrink: 0;
            border-radius: 0;
        }

        .tci-header::before {
            content: '';
            position: absolute;
            top: -20px;
            right: -20px;
            width: 100px;
            height: 100px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            opacity: 0.3;
        }

        .tci-logo {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 2;
        }

        .tci-cube {
            width: 28px;
            height: 28px;
            position: relative;
            transform: rotateX(15deg) rotateY(-15deg);
            margin-right: 12px;
        }

        .cube-face {
            position: absolute;
            width: 28px;
            height: 28px;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .cube-front {
            background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
            transform: translateZ(14px);
        }

        .cube-right {
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            transform: rotateY(90deg) translateZ(14px);
        }

        .cube-top {
            background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
            transform: rotateX(90deg) translateZ(14px);
        }

        .tci-header h2 {
            font-size: 1.4em;
            margin-bottom: 4px;
            font-weight: 600;
            position: relative;
            z-index: 2;
        }

        .tci-header p {
            opacity: 0.9;
            font-size: 1em;
            position: relative;
            z-index: 2;
            font-weight: 400;
        }

        /* Tela Inicial */
        .tci-welcome-screen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            z-index: 100;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            animation: tci-welcome-fade-in 0.8s ease-out;
            overflow-y: auto;
            max-height: 100vh;
        }

        .tci-welcome-screen.fade-out {
            animation: tci-welcome-fade-out 0.5s ease-in forwards;
        }

        @keyframes tci-welcome-fade-in {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes tci-welcome-fade-out {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-20px); }
        }

        .tci-welcome-logo {
            margin-bottom: 20px;
            position: relative;
        }

        .tci-welcome-cube {
            width: 60px;
            height: 60px;
            position: relative;
            transform: rotateX(15deg) rotateY(-15deg);
            margin: 0 auto 15px;
            animation: tci-cube-rotate 4s ease-in-out infinite;
        }

        @keyframes tci-cube-rotate {
            0%, 100% { transform: rotateX(15deg) rotateY(-15deg); }
            25% { transform: rotateX(15deg) rotateY(45deg); }
            50% { transform: rotateX(-15deg) rotateY(45deg); }
            75% { transform: rotateX(-15deg) rotateY(-15deg); }
        }

        .tci-welcome-cube .cube-face {
            width: 60px;
            height: 60px;
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 6px;
        }

        .tci-welcome-cube .cube-front {
            background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
            transform: translateZ(30px);
        }

        .tci-welcome-cube .cube-right {
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            transform: rotateY(90deg) translateZ(30px);
        }

        .tci-welcome-cube .cube-top {
            background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
            transform: rotateX(90deg) translateZ(30px);
        }

        .tci-welcome-title {
            font-size: 2em;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 12px;
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .tci-welcome-subtitle {
            font-size: 1em;
            color: #64748b;
            margin-bottom: 25px;
            max-width: 500px;
            line-height: 1.4;
        }

        .tci-welcome-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            max-width: 700px;
            width: 100%;
            margin-bottom: 25px;
        }

        .tci-welcome-feature {
            background: white;
            padding: 18px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-left: 3px solid #3b82f6;
            transition: all 0.3s ease;
        }

        .tci-welcome-feature:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .tci-welcome-feature-icon {
            font-size: 1.8em;
            margin-bottom: 10px;
            display: block;
        }

        .tci-welcome-feature h4 {
            font-size: 1em;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 6px;
        }

        .tci-welcome-feature p {
            font-size: 0.85em;
            color: #64748b;
            line-height: 1.3;
        }

        .tci-welcome-start {
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .tci-welcome-start:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }

        .tci-welcome-tips {
            margin-top: 20px;
            font-size: 0.8em;
            color: #64748b;
            max-width: 450px;
        }

        .tci-welcome-tips strong {
            color: #3b82f6;
        }

        .tci-content {
            padding: 18px;
            background: white;
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
            overflow: hidden;
        }

        .tci-search-container {
            position: relative;
            margin-bottom: 16px;
            flex-shrink: 0;
        }

        .tci-search-input {
            width: 100%;
            padding: 16px 60px 16px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
            background: #f8fafc;
        }

        .tci-search-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            background: white;
        }

        .tci-search-btn {
            position: absolute;
            right: 6px;
            top: 50%;
            transform: translateY(-50%);
            background: #3b82f6;
            border: none;
            border-radius: 8px;
            color: white;
            padding: 12px 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
        }

        .tci-search-btn:hover {
            background: #1e40af;
            transform: translateY(-50%) scale(1.05);
        }

        .tci-suggestions {
            margin-bottom: 20px;
            flex-shrink: 0;
        }

        .tci-suggestions-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #1e293b;
            display: flex;
            align-items: center;
        }

        .tci-suggestions-title::before {
            content: '⚡';
            margin-right: 8px;
            font-size: 16px;
        }

        .tci-suggestion-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .tci-suggestion-tag {
            background: #f1f5f9;
            border: 2px solid #cbd5e1;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #475569;
            font-size: 13px;
            font-weight: 500;
            white-space: nowrap;
        }

        .tci-suggestion-tag:hover {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
            transform: translateY(-2px);
        }

        .tci-results-container {
            border-top: 2px solid #e2e8f0;
            padding-top: 20px;
            display: none;
            flex: 1;
            min-height: 0;
        }

        .tci-results-container.show {
            display: flex;
            flex-direction: column;
        }

        #results {
            flex: 1;
            overflow-y: auto;
            padding-right: 8px;
            min-height: 300px;
        }

        #results::-webkit-scrollbar {
            width: 6px;
        }

        #results::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }

        #results::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }

        #results::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .tci-result-item {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            border-left: 4px solid #3b82f6;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .tci-result-item:hover {
            transform: translateX(4px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            background: #f1f5f9;
            border-color: #3b82f6;
        }

        .tci-result-title {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 8px;
            font-size: 16px;
            line-height: 1.4;
        }

        .tci-result-content {
            color: #64748b;
            line-height: 1.6;
            font-size: 14px;
            display: -webkit-box;
            -webkit-line-clamp: 4;
            -webkit-box-orient: vertical;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .tci-result-page {
            font-size: 12px;
            color: #94a3b8;
            margin-top: 8px;
            font-style: italic;
            font-weight: 500;
        }

        .tci-highlight {
            background: #fbbf24;
            color: #92400e;
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: 600;
        }

        .tci-loading {
            text-align: center;
            padding: 40px;
            color: #64748b;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
        }

        .tci-loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #e2e8f0;
            border-radius: 50%;
            border-top-color: #3b82f6;
            animation: tci-spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes tci-spin {
            to { transform: rotate(360deg); }
        }

        .tci-no-results {
            text-align: center;
            padding: 40px;
            color: #64748b;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .tci-no-results h4 {
            font-size: 18px;
            margin-bottom: 8px;
            color: #1e293b;
            font-weight: 600;
        }

        .tci-no-results p {
            font-size: 14px;
            line-height: 1.5;
        }

        .tci-no-results::before {
            content: '🔍';
            font-size: 48px;
            display: block;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .tci-detail-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .tci-detail-content {
            background: white;
            border-radius: 16px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.25);
            max-width: 700px;
            max-height: 80vh;
            width: 100%;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            animation: tci-modal-appear 0.3s ease-out;
        }

        @keyframes tci-modal-appear {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .tci-detail-header {
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            color: white;
            padding: 20px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .tci-detail-title {
            font-size: 16px;
            font-weight: 600;
            margin: 0;
        }

        .tci-detail-close {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: background-color 0.2s ease;
        }

        .tci-detail-close:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .tci-detail-body {
            padding: 24px;
            overflow-y: auto;
            flex: 1;
        }

        .tci-detail-text {
            color: #334155;
            line-height: 1.6;
            font-size: 14px;
            margin-bottom: 20px;
        }

        .tci-detail-page-info {
            background: #f1f5f9;
            border-radius: 8px;
            padding: 16px;
            border-left: 4px solid #3b82f6;
        }

        .tci-detail-page-info strong {
            color: #1e293b;
            font-size: 14px;
        }

        .tci-detail-page-info span {
            color: #64748b;
            font-size: 13px;
        }

        .tci-more-results {
            text-align: center;
            padding: 20px;
            margin-top: 16px;
            border-top: 2px dashed #e2e8f0;
        }

        .tci-more-btn {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            border: 2px solid #cbd5e1;
            border-radius: 12px;
            padding: 16px 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            width: 100%;
            max-width: 300px;
            margin: 0 auto;
        }

        .tci-more-btn:hover {
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            color: white;
            border-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.25);
        }

        .tci-more-btn span:first-child {
            font-size: 14px;
            font-weight: 600;
        }

        .tci-more-count {
            font-size: 12px;
            opacity: 0.8;
        }

        .tci-more-btn:hover .tci-more-count {
            opacity: 0.9;
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .tci-content {
                padding: 16px;
            }
            
            .tci-header {
                padding: 16px 20px;
            }
            
            .tci-search-input {
                font-size: 14px;
                padding: 12px 50px 12px 16px;
            }

            .tci-result-item {
                padding: 16px;
            }

            .tci-result-title {
                font-size: 14px;
            }

            .tci-result-content {
                font-size: 13px;
            }

            .tci-welcome-title {
                font-size: 2em;
            }

            .tci-welcome-features {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .tci-suggestion-tag {
                font-size: 12px;
                padding: 6px 12px;
            }
            
            .tci-search-input {
                font-size: 14px;
                padding: 10px 45px 10px 14px;
            }

            .tci-search-btn {
                padding: 10px 12px;
            }

            .tci-welcome-screen {
                padding: 20px 16px;
            }

            .tci-welcome-title {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <!-- Tela Inicial -->
    <div class="tci-welcome-screen" id="welcomeScreen">
        <div class="tci-welcome-logo">
            <div class="tci-welcome-cube">
                <div class="cube-face cube-front"></div>
                <div class="cube-face cube-right"></div>
                <div class="cube-face cube-top"></div>
            </div>
            <h1 class="tci-welcome-title">Agente TCI</h1>
            <p class="tci-welcome-subtitle">Seu assistente inteligente para consulta do Manual de Processos</p>
        </div>

        <div class="tci-welcome-features">
            <div class="tci-welcome-feature">
                <span class="tci-welcome-feature-icon">🔍</span>
                <h4>Busca Inteligente</h4>
                <p>Encontre informações específicas rapidamente usando palavras-chave ou frases completas</p>
            </div>
            <div class="tci-welcome-feature">
                <span class="tci-welcome-feature-icon">📊</span>
                <h4>Resultados Relevantes</h4>
                <p>Sistema de relevância que prioriza os resultados mais importantes para sua consulta</p>
            </div>
            <div class="tci-welcome-feature">
                <span class="tci-welcome-feature-icon">⚡</span>
                <h4>Interface Rápida</h4>
                <p>Navegação intuitiva com sugestões e visualização detalhada de cada resultado</p>
            </div>
        </div>

        <button class="tci-welcome-start" onclick="startSearch()">Começar Pesquisa</button>

        <div class="tci-welcome-tips">
            <strong>Dica:</strong> Use termos específicos como "cadastro", "aprovação", "documento" ou "prazo" para obter melhores resultados
        </div>
    </div>

    <!-- Interface Principal -->
    <div class="tci-agent" data-compact="false">
        <div class="tci-header">
            <div class="tci-logo">
                <div class="tci-cube">
                    <div class="cube-face cube-front"></div>
                    <div class="cube-face cube-right"></div>
                    <div class="cube-face cube-top"></div>
                </div>
                <div>
                    <h2>Agente TCI</h2>
                    <p>Manual de Processos</p>
                </div>
            </div>
        </div>
        
        <div class="tci-content">
            <div class="tci-search-container">
                <input type="text" class="tci-search-input" placeholder="Digite sua pergunta..." id="searchInput">
                <button class="tci-search-btn" onclick="performSearch()" id="searchBtn">🔍</button>
            </div>
            
            <div class="tci-suggestions">
                <div class="tci-suggestions-title">Pesquisas frequentes:</div>
                <div class="tci-suggestion-tags">
                    <button class="tci-suggestion-tag" onclick="searchSuggestion('cadastro')">Cadastro</button>
                    <button class="tci-suggestion-tag" onclick="searchSuggestion('aprovação')">Aprovação</button>
                    <button class="tci-suggestion-tag" onclick="searchSuggestion('processo')">Processo</button>
                    <button class="tci-suggestion-tag" onclick="searchSuggestion('documento')">Documento</button>
                    <button class="tci-suggestion-tag" onclick="searchSuggestion('pagamento')">Pagamento</button>
                    <button class="tci-suggestion-tag" onclick="searchSuggestion('prazo')">Prazo</button>
                </div>
            </div>
            
            <div class="tci-results-container" id="resultsContainer">
                <div class="tci-loading" id="loading" style="display: none;">Pesquisando...</div>
                <div id="results"></div>
            </div>
        </div>
    </div>

    <!-- Modal para detalhes -->
    <div class="tci-detail-modal" id="detailModal">
        <div class="tci-detail-content">
            <div class="tci-detail-header">
                <h3 class="tci-detail-title" id="detailTitle">Detalhes do Resultado</h3>
                <button class="tci-detail-close" onclick="closeDetailModal()">×</button>
            </div>
            <div class="tci-detail-body">
                <div class="tci-detail-text" id="detailText"></div>
                <div class="tci-detail-page-info" id="detailPageInfo"></div>
            </div>
        </div>
    </div>

    <!-- PDF.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

    <script>
        let pdfData = [];
        let pdfLoaded = false;

        // Lista de possíveis nomes para o PDF do manual
        const possiblePdfNames = [
            'manual-tci.pdf',
            'manual_tci.pdf',
            'manual-processos.pdf',
            'manual_processos.pdf',
            'manual.pdf',
            'tci-manual.pdf',
            'tci_manual.pdf',
            'processos.pdf',
            'manual-procedimentos.pdf',
            'manual_procedimentos.pdf'
        ];

        // Configurar PDF.js
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        // Função para iniciar a pesquisa (ocultar tela inicial)
        function startSearch() {
            const welcomeScreen = document.getElementById('welcomeScreen');
            welcomeScreen.classList.add('fade-out');
            
            setTimeout(() => {
                welcomeScreen.style.display = 'none';
                document.getElementById('searchInput').focus();
            }, 500);
        }

        // Função para tentar carregar PDFs automaticamente
        async function tryLoadPdf() {
            for (const pdfName of possiblePdfNames) {
                try {
                    // Tentar carregar o PDF
                    const response = await fetch(pdfName);
                    
                    if (response.ok) {
                        const arrayBuffer = await response.arrayBuffer();
                        const uint8Array = new Uint8Array(arrayBuffer);
                        
                        await loadPDF(uint8Array, pdfName);
                        return true; // PDF carregado com sucesso
                    }
                } catch (error) {
                    // Continuar tentando outros nomes
                    continue;
                }
            }

            // Se chegou aqui, não encontrou nenhum PDF - mas não mostra erro
            return false;
        }

        async function loadPDF(data, fileName) {
            try {
                const pdf = await pdfjsLib.getDocument(data).promise;
                pdfData = [];

                for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
                    const page = await pdf.getPage(pageNum);
                    const textContent = await page.getTextContent();
                    
                    const pageText = textContent.items
                        .map(item => item.str)
                        .join(' ')
                        .replace(/\s+/g, ' ')
                        .trim();
                    
                    if (pageText.length > 20) {
                        const sections = splitIntoSections(pageText, pageNum);
                        pdfData.push(...sections);
                    }
                }

                pdfLoaded = true;
                
            } catch (error) {
                console.error('Erro ao processar PDF:', error);
            }
        }

        function splitIntoSections(text, pageNum) {
            const sections = [];
            const words = text.split(' ');
            const chunkSize = 200;
            
            for (let i = 0; i < words.length; i += chunkSize) {
                const chunk = words.slice(i, i + chunkSize).join(' ');
                if (chunk.trim().length > 50) {
                    sections.push({
                        content: chunk,
                        page: pageNum,
                        section: Math.floor(i / chunkSize) + 1
                    });
                }
            }
            
            return sections;
        }

        function performSearch() {
            // Se a tela inicial ainda estiver visível, ocultá-la primeiro
            const welcomeScreen = document.getElementById('welcomeScreen');
            if (welcomeScreen.style.display !== 'none') {
                startSearch();
                
                // Aguardar a transição antes de fazer a pesquisa
                setTimeout(() => {
                    executeSearch();
                }, 600);
            } else {
                executeSearch();
            }
        }

        function executeSearch() {
            const query = document.getElementById('searchInput').value.trim().toLowerCase();
            if (!query) return;
            
            showResults();
            showLoading();
            
            setTimeout(() => {
                let results = [];
                if (pdfLoaded) {
                    results = searchInPDF(query);
                } else {
                    // Se não há PDF, fazer busca simulada
                    results = simulateSearch(query);
                }
                displayResults(results, query);
            }, 300);
        }

        function simulateSearch(query) {
            // Busca simulada caso não haja PDF carregado - 8 resultados simulados
            const simulatedResults = [
                {
                    content: `Processo de ${query}: Documentação necessária para abertura de processo relacionado a ${query}. Este procedimento deve ser seguido conforme as diretrizes estabelecidas no manual de processos da organização.`,
                    page: 1,
                    section: 1,
                    relevance: 15
                },
                {
                    content: `Procedimentos para ${query}: Fluxo detalhado das etapas necessárias para execução de ${query}. Importante verificar todos os requisitos antes de iniciar o processo.`,
                    page: 2,
                    section: 1,
                    relevance: 12
                },
                {
                    content: `Aprovação de ${query}: Critérios e responsáveis pela aprovação de processos relacionados a ${query}. O tempo médio de aprovação é de 5 a 10 dias úteis.`,
                    page: 3,
                    section: 2,
                    relevance: 10
                },
                {
                    content: `Documentação para ${query}: Lista completa de documentos necessários para solicitações de ${query}. Verifique se todos os documentos estão atualizados e válidos.`,
                    page: 4,
                    section: 1,
                    relevance: 9
                },
                {
                    content: `Prazos para ${query}: Cronograma e prazos estabelecidos para conclusão de processos de ${query}. É importante respeitar as datas para evitar atrasos.`,
                    page: 5,
                    section: 3,
                    relevance: 8
                },
                {
                    content: `Alterações em ${query}: Procedimentos para modificação ou cancelamento de processos já iniciados relacionados a ${query}.`,
                    page: 6,
                    section: 2,
                    relevance: 7
                },
                {
                    content: `Consulta de ${query}: Como acompanhar o andamento e status atual de processos de ${query} através do sistema interno.`,
                    page: 7,
                    section: 1,
                    relevance: 6
                },
                {
                    content: `Recursos para ${query}: Informações sobre recursos disponíveis e canais de suporte para dúvidas relacionadas a ${query}.`,
                    page: 8,
                    section: 4,
                    relevance: 5
                }
            ];
            return simulatedResults;
        }

        function searchInPDF(query) {
            const results = [];
            const queryWords = query.toLowerCase().split(' ').filter(word => word.length > 2);
            
            pdfData.forEach(section => {
                const content = section.content.toLowerCase();
                let relevance = 0;
                let hasMatch = false;
                
                // Busca exata
                if (content.includes(query)) {
                    relevance += 20;
                    hasMatch = true;
                }
                
                // Busca por palavras individuais
                queryWords.forEach(word => {
                    const wordCount = (content.match(new RegExp(word, 'g')) || []).length;
                    if (wordCount > 0) {
                        relevance += wordCount * 3;
                        hasMatch = true;
                    }
                });
                
                // Busca proximidade das palavras
                if (queryWords.length > 1) {
                    let allWordsFound = true;
                    queryWords.forEach(word => {
                        if (!content.includes(word)) {
                            allWordsFound = false;
                        }
                    });
                    if (allWordsFound) relevance += 10;
                }
                
                if (hasMatch) {
                    results.push({
                        content: section.content,
                        page: section.page,
                        section: section.section,
                        relevance: relevance
                    });
                }
            });
            
            return results
                .sort((a, b) => b.relevance - a.relevance)
                .slice(0, 15); // Aumentado para 15 resultados
        }

        function highlightTerms(text, query) {
            const queryWords = query.toLowerCase().split(' ').filter(word => word.length > 2);
            let highlightedText = text;
            
            queryWords.forEach(word => {
                const regex = new RegExp(`(${word})`, 'gi');
                highlightedText = highlightedText.replace(regex, '<span class="tci-highlight">$1</span>');
            });
            
            return highlightedText;
        }

        let currentResultsPage = 1;
        const resultsPerPage = 1;

        function displayResults(results, query, showAll = false) {
            hideLoading();
            const resultsDiv = document.getElementById('results');
            
            if (results.length === 0) {
                resultsDiv.innerHTML = `
                    <div class="tci-no-results">
                        <h4>Nenhum resultado encontrado</h4>
                        <p>Tente usar termos diferentes ou palavras-chave mais específicas</p>
                    </div>
                `;
                return;
            }

            // Armazenar resultados globalmente
            window.currentResults = results;
            window.currentQuery = query;

            // Determinar quantos resultados mostrar
            const resultsToShow = showAll ? results.length : Math.min(results.length, resultsPerPage);
            const displayResults = results.slice(0, resultsToShow);
            
            resultsDiv.innerHTML = displayResults.map((result, index) => {
                const snippet = extractRelevantSnippet(result.content, query);
                
                return `
                    <div class="tci-result-item" onclick="showDetailModal(${index}, '${query.replace(/'/g, "\\'")}')">
                        <div class="tci-result-title">Resultado ${index + 1}</div>
                        <div class="tci-result-content">${highlightTerms(snippet, query)}</div>
                        <div class="tci-result-page">Página ${result.page}</div>
                    </div>
                `;
            }).join('');

            // Adicionar botão "Ver mais" se houver mais resultados
            if (results.length > resultsPerPage && !showAll) {
                const moreButton = document.createElement('div');
                moreButton.className = 'tci-more-results';
                moreButton.innerHTML = `
                    <button class="tci-more-btn" onclick="showMoreResults()">
                        <span>Ver mais resultados</span>
                        <span class="tci-more-count">(${results.length - resultsPerPage} restantes)</span>
                    </button>
                `;
                resultsDiv.appendChild(moreButton);
            }
        }

        function showMoreResults() {
            displayResults(window.currentResults, window.currentQuery, true);
        }

        function extractRelevantSnippet(text, query, maxLength = 300) {
            const queryWords = query.toLowerCase().split(' ').filter(word => word.length > 2);
            const lowerText = text.toLowerCase();
            
            let bestPosition = 0;
            let bestScore = 0;
            
            queryWords.forEach(word => {
                const position = lowerText.indexOf(word);
                if (position !== -1) {
                    let score = 0;
                    const window = lowerText.substring(Math.max(0, position - 50), position + 150);
                    queryWords.forEach(w => {
                        if (window.includes(w)) score++;
                    });
                    
                    if (score > bestScore) {
                        bestScore = score;
                        bestPosition = position;
                    }
                }
            });
            
            const start = Math.max(0, bestPosition - 50);
            const end = Math.min(text.length, start + maxLength);
            
            let snippet = text.substring(start, end);
            
            if (start > 0) snippet = '...' + snippet;
            if (end < text.length) snippet = snippet + '...';
            
            return snippet;
        }

        function showResults() {
            document.getElementById('resultsContainer').classList.add('show');
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'flex';
            document.getElementById('results').style.display = 'none';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('results').style.display = 'block';
        }

        function searchSuggestion(suggestion) {
            document.getElementById('searchInput').value = suggestion;
            performSearch();
        }

        // Funções do modal de detalhes
        function showDetailModal(resultIndex, query) {
            const result = window.currentResults[resultIndex];
            if (!result) return;

            document.getElementById('detailTitle').textContent = `Resultado ${resultIndex + 1}`;
            document.getElementById('detailText').innerHTML = highlightTerms(result.content, query);
            document.getElementById('detailPageInfo').innerHTML = `
                <strong>Localização:</strong> 
                <span>Página ${result.page}, Seção ${result.section}</span>
            `;

            document.getElementById('detailModal').style.display = 'flex';
        }

        function closeDetailModal() {
            document.getElementById('detailModal').style.display = 'none';
        }

        // Fechar modal ao clicar fora
        document.addEventListener('click', function(e) {
            const modal = document.getElementById('detailModal');
            if (e.target === modal) {
                closeDetailModal();
            }
        });

        // Fechar modal com ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeDetailModal();
            }
        });

        // Event listeners
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performSearch();
            }
        });

        // Inicialização - carregar PDF automaticamente
        document.addEventListener('DOMContentLoaded', async function() {
            // Ocultar títulos de web parts do SharePoint
            const webpartTitles = document.querySelectorAll('.ms-webpart-chrome-title');
            webpartTitles.forEach(title => {
                if (title.textContent.includes('Agente') || title.textContent.includes('TCI')) {
                    title.style.display = 'none';
                }
            });

            // Tentar carregar PDF automaticamente (silenciosamente)
            await tryLoadPdf();
        });
    </script>
</body>
</html>
